#!/usr/bin/env python3
import sys
import subprocess
import tempfile
import shutil
import os

# --- Konfigurace ---
REPO_URL = "https://github.com/ExistingPerson08/Spacefin-themes.git"
# N√°zev slo≈æky, kter√° vznikne po naklonov√°n√≠ repozit√°≈ôe
REPO_FOLDER_NAME = "Spacefin-themes"
# C√≠lov√Ω adres√°≈ô pro konfiguraci
CONFIG_DIR = os.path.expanduser("~/.config/cosmic/")
# --------------------


def main():
    # 1. Kontrola, zda byl zad√°n argument (n√°zev t√©matu)
    if len(sys.argv) != 2:
        print(f"Chyba: Mus√≠≈° zadat n√°zev t√©matu (slo≈æky).")
        print(f"Pou≈æit√≠: python3 {sys.argv[0]} <n√°zev_t√©matu>")
        sys.exit(1)  # Ukonƒç√≠ skript s chybov√Ωm k√≥dem

    theme_name = sys.argv[1]
    print(f"üîÑ Pokou≈°√≠m se nastavit t√©ma: {theme_name}")

    # 2. Vytvo≈ôen√≠ doƒçasn√©ho adres√°≈ôe
    # Pou≈æit√≠ 'with' zajist√≠, ≈æe se adres√°≈ô automaticky sma≈æe po dokonƒçen√≠
    with tempfile.TemporaryDirectory() as temp_dir:
        clone_path = os.path.join(temp_dir, REPO_FOLDER_NAME)
        print(f"üåç Klonuji repozit√°≈ô z {REPO_URL}...")

        # 3. Klonov√°n√≠ repozit√°≈ôe pomoc√≠ 'git'
        try:
            # --depth 1 st√°hne pouze posledn√≠ verzi, je to mnohem rychlej≈°√≠
            subprocess.run(
                ["git", "clone", "--depth", "1", REPO_URL, clone_path],
                check=True,  # Pokud git sel≈æe, vyvol√° chybu
                capture_output=True,  # Zachyt√≠ v√Ωstup, aby se nezobrazoval
                text=True,
            )
            print("‚úÖ Repozit√°≈ô √∫spƒõ≈°nƒõ naklonov√°n.")
        except FileNotFoundError:
            print(
                f"‚ùå CHYBA: Program 'git' nebyl nalezen. Ujisti se, ≈æe je nainstalov√°n."
            )
            sys.exit(1)
        except subprocess.CalledProcessError as e:
            print(f"‚ùå CHYBA: Selhalo klonov√°n√≠ repozit√°≈ôe.")
            print(e.stderr)  # Vyps√°n√≠ chyby z gitu
            sys.exit(1)

        # 4. Definov√°n√≠ cest
        # Zdroj: Slo≈æka s t√©matem uvnit≈ô naklonovan√©ho repozit√°≈ôe
        source_dir = os.path.join(clone_path, theme_name)

        # C√≠l: Tv≈Øj lok√°ln√≠ konfiguraƒçn√≠ adres√°≈ô
        dest_dir = CONFIG_DIR

        # 5. Kontrola, zda zadan√© t√©ma (slo≈æka) v repozit√°≈ôi existuje
        if not os.path.isdir(source_dir):
            print(f"‚ùå CHYBA: T√©ma '{theme_name}' nebylo nalezeno v repozit√°≈ôi.")
            print("Zkontroluj n√°zev a zkus to znovu.")
            sys.exit(1)

        # 6. Zaji≈°tƒõn√≠ existence c√≠lov√©ho adres√°≈ôe
        os.makedirs(dest_dir, exist_ok=True)

        print(f"üìÇ Kop√≠ruji soubory z '{theme_name}' do '{dest_dir}'...")
        try:
            shutil.copytree(source_dir, dest_dir, dirs_exist_ok=True)
            print(f"üéâ Hotovo! T√©ma '{theme_name}' bylo √∫spƒõ≈°nƒõ nastaveno.")
        except TypeError:
            print("‚ùå CHYBA: Tv√° verze Pythonu je p≈ô√≠li≈° star√°.")
            print("Tento skript vy≈æaduje Python 3.8 nebo novƒõj≈°√≠.")
            sys.exit(1)
        except Exception as e:
            print(f"‚ùå CHYBA: Selhalo kop√≠rov√°n√≠ soubor≈Ø.")
            print(e)
            sys.exit(1)


if __name__ == "__main__":
    main()
